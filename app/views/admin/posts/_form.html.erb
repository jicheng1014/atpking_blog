<%= form_with(model: [:admin, post], class: "space-y-6") do |f| %>
  <% if post.errors.any? %>
    <div class="p-4 mb-6 text-red-500 rounded-md bg-red-50">
      <ul class="list-disc list-inside">
        <% post.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :title, '标题', class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :title, class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div data-controller="markdown-editor"
       class="space-y-4"
       data-markdown-editor-post-id-value="<%= post.id || 'new' %>"
       data-markdown-editor-post-updated-at-value="<%= post.updated_at&.to_i || Time.current.to_i %>">
    <div class="flex items-center justify-between mb-2">
      <%= f.label :content, '内容', class: "block text-sm font-medium text-gray-700" %>
      <div class="text-sm text-gray-500" data-markdown-editor-target="autoSaveStatus"></div>
    </div>

    <div class="border rounded-md">
      <div class="border-b">
        <nav class="flex -mb-px" aria-label="Tabs">
          <button type="button"
                  class="px-4 py-2 text-sm font-medium transition-colors duration-200 border-b-2"
                  data-markdown-editor-target="editorTab"
                  data-action="click->markdown-editor#switchToEditor">
            编辑
          </button>
          <button type="button"
                  class="px-4 py-2 text-sm font-medium transition-colors duration-200 border-b-2"
                  data-markdown-editor-target="previewTab"
                  data-action="click->markdown-editor#switchToPreview">
            预览
          </button>
        </nav>
      </div>

      <div class="relative" style="min-height: 500px">
        <div class="relative">
          <%= f.text_area :content,
              rows: 20,
              class: "w-full p-4 border-0 rounded-none focus:ring-0",
              style: "min-height: 500px; resize: vertical;",
              data: {
                controller: "paste-image",
                paste_image_target: "editor",
                markdown_editor_target: "editor",
                action: "input->markdown-editor#updatePreview keydown->markdown-editor#handleKeydown"
              } %>
          <div class="absolute bottom-0 right-0 p-2 text-xs text-gray-500" data-markdown-editor-target="lastSaveTime"></div>
        </div>

        <div class="absolute inset-0 hidden p-4 overflow-y-auto prose-sm prose bg-white max-w-none"
             data-markdown-editor-target="preview">
        </div>
      </div>
    </div>
  </div>

  <div>
    <%= f.label :status, '状态', class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.select :status, options_for_select([['草稿', 'draft'], ['发布', 'published']], post.status), {}, class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <div class="flex justify-end gap-4">
    <%= link_to '取消', admin_posts_path, class: "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50" %>
    <%= f.submit post.new_record? ? '创建' : '更新', class: "px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600" %>
  </div>
<% end %>